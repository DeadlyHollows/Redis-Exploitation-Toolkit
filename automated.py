from importlib import import_module
from sys import exit



# TODO: Move it out of here and place it in the modules folder!
def get_automated_attack_sequence():
    return ["enum", "rce"]



def execute_attack_sequence(attack_module_path, available_attacks):

    for attack in available_attacks:

        if isinstance(attack, str):

            if isinstance(available_attacks, dict):
                execute_attack_sequence(attack_module_path + [attack], available_attacks[attack])

            else:
                attack_function_path = attack_module_path + [attack]
                print ("=====>" , "Performing", "/".join(attack_function_path), "<=====")

                try:
                    getattr(import_module("modules." + ".".join(attack_function_path[:-1])), attack_function_path[-1])()
                except KeyboardInterrupt:
                    print ("\n\nSkipping this attack...")
                except EOFError:
                    print ("\n\nExiting...")
                    exit(-1)

                print ("[===========================================================================================]\n")

        else:
            execute_attack_sequence(attack_module_path, attack)



def launch_in_automated_mode():

    print ("\n[INFO] Press CTRL+C to skip an attack.")
    print ("[INFO] Press CTRL+D to stop the tool.\n")

    for attack_module in get_automated_attack_sequence():
        execute_attack_sequence(
            [attack_module],
            getattr(import_module(f"modules.{attack_module}"), "AVAILABLE_ATTACKS")
        )



if __name__ == "__main__":
    launch_in_automated_mode()