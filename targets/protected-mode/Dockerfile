FROM redis:6.2.6

RUN apt-get update \
    && apt-get install -y apache2 cron iproute2 openssh-server procps vim

# Config for a vulnerable Redis instance
# Kindly don't use this config in production,
# unless you are aware of the dangers it brings
COPY files/redis.conf /etc/redis/redis.conf

# Malicious Redis module
COPY files/evil_module.so /tmp/

COPY files/startup_scripts /

RUN mkdir /var/lib/redis /var/log/redis \
    && chown redis:redis /var/lib/redis /var/log/redis \
    && chmod 770 /var/lib/redis /var/log/redis \
    && chmod +x /startup.sh /load_data.sh

ENTRYPOINT [ "/startup.sh" ]
